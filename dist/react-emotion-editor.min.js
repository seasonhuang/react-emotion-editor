"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var _react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),ENTER_KEY=13,Editor=_react2["default"].createClass({displayName:"Editor",propTypes:{content:_react2["default"].PropTypes.string.isRequired,className:_react2["default"].PropTypes.string,onEnter:_react2["default"].PropTypes.func,onAltEnter:_react2["default"].PropTypes.func,onCtrlEnter:_react2["default"].PropTypes.func,onShiftEnter:_react2["default"].PropTypes.func,onChange:_react2["default"].PropTypes.func},componentWillReceiveProps:function(e){this.setContent(e.content)},setContent:function(e){(0,_reactDom.findDOMNode)(this).innerHTML=e},getContent:function(){var e=(0,_reactDom.findDOMNode)(this).innerHTML;return e=e.replace(/<br[^>]*>/g,"\n"),e=e.replace(/<img(?!.*data-is=[\'\"]emotion[\'\"])[^>]*>/g,""),e=e.trim()},insertHTML:function(e){(0,_reactDom.findDOMNode)(this).focus(),this.restoreRange();var t=e+'<img style="width: 1px; height: 1px;">',n=window.getSelection(),o=n.getRangeAt(0),i=o.createContextualFragment(t);o.deleteContents(),o.insertNode(i),o.collapse(!1),n.removeAllRanges(),n.addRange(o),document.execCommand("Delete",!1,null),this.saveRange()},saveRange:function(){var e=window.getSelection(),t=e.getRangeAt(0);this._range=t},restoreRange:function(){var e=window.getSelection();this._range?(e.removeAllRanges(),e.addRange(this._range)):(0,_reactDom.findDOMNode)(this).focus()},filterElement:function(e,t){var n=e.tagName.toUpperCase();if("IMG"!==n||"emotion"!==e.dataset.is){var o=void 0;o="BR"===n?"\n":e.innerText;var i=document.createTextNode(o);t.replaceChild(i,e)}},filterHTML:function(e){var t=this,n=e.childNodes;Array.from(n,function(n){switch(n.nodeType){case n.ELEMENT_NODE:t.filterElement(n,e);break;case n.TEXT_NODE:break;default:e.removeChild(n)}})},handleCompositionStart:function(){this._isCompositing=!0},handleCompositionEnd:function(){this._isCompositing=!1},handleInput:function(){this._isCompositing||(this.filterHTML((0,_reactDom.findDOMNode)(this)),this.props.onChange&&this.props.onChange(this.getContent()))},handleKeyDown:function(e){ENTER_KEY===e.keyCode&&(e.altKey?this.props.onAltEnter&&this.props.onAltEnter(e):e.ctrlKey?this.props.onCtrlEnter&&this.props.onCtrlEnter(e):e.shiftKey?this.props.onShiftEnter&&this.props.onShiftEnter(e):this.props.onEnter&&this.props.onEnter(e))},handleKeyUp:function(){this.saveRange()},handleMouseUp:function(){this.saveRange()},render:function(){return _react2["default"].createElement("pre",{className:this.props.className,contentEditable:"true",ref:"editor",onCompositionStart:this.handleCompositionStart,onCompositionEnd:this.handleCompositionEnd,onInput:this.handleInput,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onMouseUp:this.onMouseUp})}});module.exports=Editor;